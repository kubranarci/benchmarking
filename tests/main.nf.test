nextflow_pipeline {

    name "Test pipeline"
    script "../main.nf"
    tag "pipeline"
    tag "pipeline_variantbenchmarking"

    test("Run with profile test") {

        config "../conf/test.config"
        when {
            params {
                max_cpus             = 2
                max_memory           = '6.GB'
                max_time             = '6.h'
                input                = "https://raw.githubusercontent.com/kubranarci/benchmark_datasets/main/SV_testdata/samplesheet_HG002_hg38.csv"
                outdir               = "$outputDir"
            }
        }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }
    test("Run with profile test somatic") {
        config "../conf/test_somatic.config"
        when {
            params {
                max_cpus            = 2
                max_memory          = '6.GB'
                max_time            = '6.h'
                input               = 'https://raw.githubusercontent.com/kubranarci/benchmark_datasets/main/sarek_full_test_somatic_v3.4.2/samplesheet_somatic.csv'
                outdir              = 'results'
            }
        }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }
    test("Run with profile test liftover") {
        config "../conf/test_liftover.config"
        when {
            params {
                    max_cpus            = 2
                    max_memory          = '6.GB'
                    max_time            = '6.h'
                    input               = 'https://raw.githubusercontent.com/kubranarci/benchmark_datasets/main/SV_testdata/samplesheet_HG002_hg38.csv'
                    outdir              = 'results'
                }
            }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }
    test("Run with profile test stub") {
        options "-stub"
        config "../conf/test.config"
        when {
            params {
                    max_cpus            = 2
                    max_memory          = '6.GB'
                    max_time            = '6.h'
                    input               = 'https://raw.githubusercontent.com/kubranarci/benchmark_datasets/main/SV_testdata/samplesheet_HG002_hg38.csv'
                    outdir              = 'results'
                }
            }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }
}
